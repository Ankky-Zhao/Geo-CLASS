/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var rich_forest = /* color: #1f5a09 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[104.76064682006836, 8.628733343548186],
                  [104.76511001586914, 8.631618545110644],
                  [104.76356506347656, 8.636031163662174],
                  [104.75652694702148, 8.632636846279205]]]),
            {
              "class": 1,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[104.72150802612305, 8.634334008787526],
                  [104.72648620605469, 8.634673440373192],
                  [104.72700119018555, 8.638576881657826],
                  [104.71927642822266, 8.63789802520566]]]),
            {
              "class": 1,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[104.77712631225586, 8.587659263325353],
                  [104.78073120117188, 8.587659263325353],
                  [104.77935791015625, 8.59088424894551],
                  [104.77455139160156, 8.590205306883016]]]),
            {
              "class": 1,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[104.78588104248047, 8.639104274878818],
                  [104.79480743408203, 8.643177382229752],
                  [104.79412078857422, 8.648947542296028],
                  [104.78107452392578, 8.643516805855887]]]),
            {
              "class": 1,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[104.81815337087028, 8.70323294979706],
                  [104.82055663014762, 8.701875469284943],
                  [104.82107161427848, 8.704590425385831],
                  [104.81781004811637, 8.705099477462186]]]),
            {
              "class": 1,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[104.80321883107536, 8.716298447872871],
                  [104.80476378346793, 8.718334588269167],
                  [104.8027038469445, 8.720370717569335],
                  [104.80030058766715, 8.717655876036519]]]),
            {
              "class": 1,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[104.87857817555778, 8.745312400008492],
                  [104.88012312795036, 8.747687711305666],
                  [104.87754820729606, 8.749384352955527],
                  [104.87634657765739, 8.74734838204796]]]),
            {
              "class": 1,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[105.2219009399414, 8.820127408249503],
                  [105.22602081298828, 8.820127408249503],
                  [105.22550582885742, 8.826064459814846],
                  [105.22104263305664, 8.825216315438151]]]),
            {
              "class": 1,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[105.26945114135742, 8.777377822754076],
                  [105.27477264404297, 8.782128020357083],
                  [105.27442932128906, 8.784672744048175],
                  [105.26756286621094, 8.780261878552828]]]),
            {
              "class": 1,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[105.09461402369197, 8.637464916408877],
                  [105.0963306374615, 8.63873777271603],
                  [105.09547233057674, 8.641113759661208],
                  [105.09332656336483, 8.639077200339079]]]),
            {
              "class": 1,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[105.07246970606502, 8.659781707185921],
                  [105.0736713357037, 8.660630228260349],
                  [105.0725555367535, 8.661987857998112],
                  [105.07083892298397, 8.660290820060247]]]),
            {
              "class": 1,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[105.10508536768612, 8.648496194967407],
                  [105.10611533594783, 8.649344741481451],
                  [105.10534285975154, 8.650617557668133],
                  [105.10379790735897, 8.649769014021615]]]),
            {
              "class": 1,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[104.83016967773438, 8.693900177065915],
                  [104.82656478881836, 8.6991604986721],
                  [104.82244491577148, 8.696615190990277]]]),
            {
              "class": 1,
              "system:index": "12"
            })]),
    no_forest = /* color: #cfeb14 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[105.14853179454803, 9.175732081535257],
                  [105.14876782894135, 9.175742673083864],
                  [105.14875710010529, 9.176007461695795],
                  [105.14849960803986, 9.176033940546114]]]),
            {
              "class": 3,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[105.15254974365234, 9.175781453056286],
                  [105.15308618545532, 9.175611988259444],
                  [105.15302181243896, 9.176014467019753],
                  [105.15257120132446, 9.176035650099738]]]),
            {
              "class": 3,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[105.14935255050659, 9.178577610513996],
                  [105.14937400817871, 9.177624377493808],
                  [105.14963150024414, 9.177560828534682],
                  [105.14965295791626, 9.178683525135835]]]),
            {
              "class": 3,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[105.14807581868808, 9.177246669772275],
                  [105.14846205678623, 9.177527344504421],
                  [105.14768958058994, 9.177352584791633]]]),
            {
              "class": 3,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[104.99183177947998, 8.760405265649405],
                  [104.99206781387329, 8.760850619608277],
                  [104.99198198318481, 8.761073296387655],
                  [104.9913489818573, 8.760426472992888]]]),
            {
              "class": 3,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[104.99233603477478, 8.759832666918463],
                  [104.99258279800415, 8.759822063229935],
                  [104.99258279800415, 8.75928127471453],
                  [104.99281883239746, 8.759249463600892],
                  [104.99285101890564, 8.760023533260084],
                  [104.99236822128296, 8.760065947989364]]]),
            {
              "class": 3,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[104.99557614326477, 8.760574924363317],
                  [104.99615550041199, 8.760596131697106],
                  [104.99608039855957, 8.760956656186512],
                  [104.99560832977295, 8.76137019855269]]]),
            {
              "class": 3,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[105.07633209228516, 8.798573874078288],
                  [105.07658958435059, 8.797216741204068],
                  [105.08053779602051, 8.797386383085414],
                  [105.08062362670898, 8.799167618146235]]]),
            {
              "class": 3,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[105.06474494934082, 8.800015822305411],
                  [105.06611824035645, 8.79611406708061],
                  [105.06817817687988, 8.796792636160603],
                  [105.06637573242188, 8.80069438423315]]]),
            {
              "class": 3,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[105.01968383789062, 9.174708308674694],
                  [105.01350402832031, 9.177419742616186],
                  [105.00732421875, 9.173352583931926]]]),
            {
              "class": 3,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[104.96183395385742, 9.178551221063916],
                  [104.96646881103516, 9.177703902887227],
                  [104.96543884277344, 9.185499153725102],
                  [104.96166229248047, 9.18702429144307]]]),
            {
              "class": 3,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[104.94895935058594, 9.212659379786949],
                  [104.95033264160156, 9.220792747041203],
                  [104.93797302246094, 9.224181594756757]]]),
            {
              "class": 3,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[104.886474609375, 9.460651507557433],
                  [104.89540100097656, 9.468101795546971],
                  [104.886474609375, 9.475551921976875],
                  [104.87686157226562, 9.466069914839851]]]),
            {
              "class": 3,
              "system:index": "12"
            })]);
/***** End of imports. If edited, may not auto-convert in the playground. *****/
// define start of time series
var startdate = ee.Date.fromYMD(2015,1,1);
// define end of time series
var enddate = ee.Date.fromYMD(2015,12,1);

// the ca basin
var CaBasin = ee.FeatureCollection('ft:1XPgyHDQHN4d5IF4x8u5ZkJxkVQ_xKWFFuUTi9ofT');

Map.centerObject(CaBasin);



// Sentinel-2 collection

var Sentinel = ee.ImageCollection('COPERNICUS/S2')
            .filterDate(startdate,enddate)
            .filterBounds(CaBasin)

Sentinel=Sentinel.map(function(image){
    return image.updateMask(image.select("QA60").eq(0));
  })

// NDVI function.
function getNDVI(img){
  var ndvi = img.expression(
    '((NIR - RED) / (NIR + RED))',
    {
      'NIR': img.select('B8'),
      'RED': img.select('B4')
    })
  return img.select([]) 
    .addBands([ndvi]) 
    .select([0], ['ndvi'])
    .copyProperties(img, img.propertyNames())
  }
  
// Apply NDVI function to the collection

var NDVI_sentinel = Sentinel.map(getNDVI);
print(NDVI_sentinel);

// Visualization of the bounds
Map.addLayer(CaBasin); 
Map.addLayer(NDVI_sentinel.median().clip(CaBasin),{min:0.0,max:0.8,palette:["red,yellow,green,darkgreen"]})

// Export the image, specifying scale and region.
Export.image.toDrive({
  image: NDVI_sentinel,
  description: 'SC_Example',
  scale: 10,
  region: CaBasin.geometry().bounds()
});




