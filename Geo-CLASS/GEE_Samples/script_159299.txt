/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var s2 = ee.ImageCollection("COPERNICUS/S2"),
    table2 = ee.FeatureCollection("users/jannat/gujratCityExt"),
    water = /* color: #d63000 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Point([74.09308716171371, 32.55692612747853]),
            {
              "landcover": 0,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Point([74.07459828944428, 32.55383081361941]),
            {
              "landcover": 0,
              "system:index": "1"
            })]),
    vegetation = /* color: #98ff00 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Point([74.07838769966729, 32.552068108506425]),
            {
              "landcover": 1,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Point([74.07905288750298, 32.55165211269797]),
            {
              "landcover": 1,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Point([74.08046909386285, 32.55089246320329]),
            {
              "landcover": 1,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Point([74.0819925885833, 32.55042220077048]),
            {
              "landcover": 1,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Point([74.07478281075127, 32.55177872032204]),
            {
              "landcover": 1,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Point([74.06733699852593, 32.551326549416046]),
            {
              "landcover": 1,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Point([74.06534143501885, 32.553750158855145]),
            {
              "landcover": 1,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Point([74.06845279747613, 32.54942740673672]),
            {
              "landcover": 1,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Point([74.07160707527764, 32.54798041391651]),
            {
              "landcover": 1,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Point([74.07175727898247, 32.54582796894502]),
            {
              "landcover": 1,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Point([74.0777225118316, 32.54580988095348]),
            {
              "landcover": 1,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Point([74.07866664940484, 32.54543003228953]),
            {
              "landcover": 1,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Point([74.08407398277886, 32.54463415368716]),
            {
              "landcover": 1,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Point([74.08420272881158, 32.54112496844773]),
            {
              "landcover": 1,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Point([74.07763668114312, 32.54134203543156]),
            {
              "landcover": 1,
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Point([74.07836624199517, 32.538483944781774]),
            {
              "landcover": 1,
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Point([74.07433219963677, 32.54110687950872]),
            {
              "landcover": 1,
              "system:index": "16"
            }),
        ee.Feature(
            ee.Geometry.Point([74.0689892392791, 32.54110687950872]),
            {
              "landcover": 1,
              "system:index": "17"
            }),
        ee.Feature(
            ee.Geometry.Point([74.06939693504937, 32.53960548486841]),
            {
              "landcover": 1,
              "system:index": "18"
            }),
        ee.Feature(
            ee.Geometry.Point([74.08589061645088, 32.53676572189461]),
            {
              "landcover": 1,
              "system:index": "19"
            }),
        ee.Feature(
            ee.Geometry.Point([74.0685313597065, 32.53454064705029]),
            {
              "landcover": 1,
              "system:index": "20"
            }),
        ee.Feature(
            ee.Geometry.Point([74.06722244170723, 32.53403411824484]),
            {
              "landcover": 1,
              "system:index": "21"
            }),
        ee.Feature(
            ee.Geometry.Point([74.07198604491768, 32.534558737311926]),
            {
              "landcover": 1,
              "system:index": "22"
            }),
        ee.Feature(
            ee.Geometry.Point([74.05518564186946, 32.571708363895986]),
            {
              "landcover": 1,
              "system:index": "23"
            }),
        ee.Feature(
            ee.Geometry.Point([74.0599492450799, 32.57478238272654]),
            {
              "landcover": 1,
              "system:index": "24"
            }),
        ee.Feature(
            ee.Geometry.Point([74.06359704934016, 32.58002605401204]),
            {
              "landcover": 1,
              "system:index": "25"
            }),
        ee.Feature(
            ee.Geometry.Point([74.07329591713801, 32.580206864793944]),
            {
              "landcover": 1,
              "system:index": "26"
            }),
        ee.Feature(
            ee.Geometry.Point([74.0841757359558, 32.577675535105755]),
            {
              "landcover": 1,
              "system:index": "27"
            }),
        ee.Feature(
            ee.Geometry.Point([74.08831706667479, 32.5794113490647]),
            {
              "landcover": 1,
              "system:index": "28"
            }),
        ee.Feature(
            ee.Geometry.Point([74.09535518312987, 32.5724859742334]),
            {
              "landcover": 1,
              "system:index": "29"
            }),
        ee.Feature(
            ee.Geometry.Point([74.09788718843993, 32.57266680021938]),
            {
              "landcover": 1,
              "system:index": "30"
            }),
        ee.Feature(
            ee.Geometry.Point([74.10237184191283, 32.575125997431996]),
            {
              "landcover": 1,
              "system:index": "31"
            }),
        ee.Feature(
            ee.Geometry.Point([74.10464635515746, 32.57382407789613]),
            {
              "landcover": 1,
              "system:index": "32"
            }),
        ee.Feature(
            ee.Geometry.Point([74.10353055620726, 32.57655447073166]),
            {
              "landcover": 1,
              "system:index": "33"
            }),
        ee.Feature(
            ee.Geometry.Point([74.10235090483643, 32.567748203495206]),
            {
              "landcover": 1,
              "system:index": "34"
            }),
        ee.Feature(
            ee.Geometry.Point([74.09623546828247, 32.56675360152115]),
            {
              "landcover": 1,
              "system:index": "35"
            }),
        ee.Feature(
            ee.Geometry.Point([74.09520550002075, 32.56787478840992]),
            {
              "landcover": 1,
              "system:index": "36"
            }),
        ee.Feature(
            ee.Geometry.Point([74.09688572205023, 32.563084872073276]),
            {
              "landcover": 1,
              "system:index": "37"
            }),
        ee.Feature(
            ee.Geometry.Point([74.09549097336249, 32.55919661773215]),
            {
              "landcover": 1,
              "system:index": "38"
            }),
        ee.Feature(
            ee.Geometry.Point([74.09630636490301, 32.55890725253333]),
            {
              "landcover": 1,
              "system:index": "39"
            }),
        ee.Feature(
            ee.Geometry.Point([74.09375290192084, 32.55778595357424]),
            {
              "landcover": 1,
              "system:index": "40"
            }),
        ee.Feature(
            ee.Geometry.Point([74.09096340454535, 32.557171041744795]),
            {
              "landcover": 1,
              "system:index": "41"
            }),
        ee.Feature(
            ee.Geometry.Point([74.09072737015204, 32.555724173760574]),
            {
              "landcover": 1,
              "system:index": "42"
            }),
        ee.Feature(
            ee.Geometry.Point([74.10029749191717, 32.560372154256626]),
            {
              "landcover": 1,
              "system:index": "43"
            }),
        ee.Feature(
            ee.Geometry.Point([74.10014728821234, 32.559033849922635]),
            {
              "landcover": 1,
              "system:index": "44"
            }),
        ee.Feature(
            ee.Geometry.Point([74.09973959244208, 32.55708061317923]),
            {
              "landcover": 1,
              "system:index": "45"
            }),
        ee.Feature(
            ee.Geometry.Point([74.09433856108691, 32.58261921120518]),
            {
              "landcover": 1,
              "system:index": "46"
            }),
        ee.Feature(
            ee.Geometry.Point([74.09781470397022, 32.58160669337377]),
            {
              "landcover": 1,
              "system:index": "47"
            }),
        ee.Feature(
            ee.Geometry.Point([74.09515395262744, 32.57938273013878]),
            {
              "landcover": 1,
              "system:index": "48"
            }),
        ee.Feature(
            ee.Geometry.Point([74.09725680449512, 32.57981667851645]),
            {
              "landcover": 1,
              "system:index": "49"
            })]),
    barren = /* color: #0b4a8b */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Point([74.07816871613211, 32.55033069913843]),
            {
              "landcover": 2,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Point([74.07855495423026, 32.55034878621906]),
            {
              "landcover": 2,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Point([74.10184827732486, 32.5695421222504]),
            {
              "landcover": 2,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Point([74.10109725880069, 32.57017503237957]),
            {
              "landcover": 2,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Point([74.09336327932688, 32.58282577376448]),
            {
              "landcover": 2,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Point([74.09382461927744, 32.583359147865956]),
            {
              "landcover": 2,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Point([74.09482240103098, 32.58199406544366]),
            {
              "landcover": 2,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Point([74.09409284017893, 32.580656083694066]),
            {
              "landcover": 2,
              "system:index": "7"
            })]),
    builtup = /* color: #ffc82d */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Point([74.07704466904494, 32.571910702482576]),
            {
              "landcover": 3,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Point([74.07890075768324, 32.57167562664794]),
            {
              "landcover": 3,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Point([74.07928699578139, 32.572353728342264]),
            {
              "landcover": 3,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Point([74.07581085289809, 32.56939716740164]),
            {
              "landcover": 3,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Point([74.08010238732192, 32.57072627566265]),
            {
              "landcover": 3,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Point([74.08292407120558, 32.571232597438645]),
            {
              "landcover": 3,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Point([74.08288115586134, 32.5696955403583]),
            {
              "landcover": 3,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Point([74.08200139130446, 32.569189209905495]),
            {
              "landcover": 3,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Point([74.06774236415608, 32.56286453829451]),
            {
              "landcover": 3,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Point([74.06808568690998, 32.56324431317646]),
            {
              "landcover": 3,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Point([74.07033874248249, 32.56456447049708]),
            {
              "landcover": 3,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Point([74.06060768817646, 32.562312957626865]),
            {
              "landcover": 3,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Point([74.06190587733967, 32.56196934828367]),
            {
              "landcover": 3,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Point([74.06191660617573, 32.56151722872193]),
            {
              "landcover": 3,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Point([74.05982448314411, 32.56088425750806]),
            {
              "landcover": 3,
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Point([74.05915929530842, 32.561282125649456]),
            {
              "landcover": 3,
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Point([74.0560586616872, 32.56171616160979]),
            {
              "landcover": 3,
              "system:index": "16"
            }),
        ee.Feature(
            ee.Geometry.Point([74.0882638665695, 32.56279622111325]),
            {
              "landcover": 3,
              "system:index": "17"
            }),
        ee.Feature(
            ee.Geometry.Point([74.08714806761931, 32.56332971434901]),
            {
              "landcover": 3,
              "system:index": "18"
            }),
        ee.Feature(
            ee.Geometry.Point([74.08692276206206, 32.56394458397374]),
            {
              "landcover": 3,
              "system:index": "19"
            }),
        ee.Feature(
            ee.Geometry.Point([74.0858498784561, 32.56258824831452]),
            {
              "landcover": 3,
              "system:index": "20"
            }),
        ee.Feature(
            ee.Geometry.Point([74.08638632025908, 32.562949939828556]),
            {
              "landcover": 3,
              "system:index": "21"
            }),
        ee.Feature(
            ee.Geometry.Point([74.0868047448654, 32.5619643270258]),
            {
              "landcover": 3,
              "system:index": "22"
            }),
        ee.Feature(
            ee.Geometry.Point([74.08917581763457, 32.5619643270258]),
            {
              "landcover": 3,
              "system:index": "23"
            }),
        ee.Feature(
            ee.Geometry.Point([74.07295502484162, 32.5549867593699]),
            {
              "landcover": 3,
              "system:index": "24"
            }),
        ee.Feature(
            ee.Geometry.Point([74.06997240841706, 32.554977716297344]),
            {
              "landcover": 3,
              "system:index": "25"
            }),
        ee.Feature(
            ee.Geometry.Point([74.0745536214145, 32.55537561062797]),
            {
              "landcover": 3,
              "system:index": "26"
            }),
        ee.Feature(
            ee.Geometry.Point([74.07029427349885, 32.55580967515851]),
            {
              "landcover": 3,
              "system:index": "27"
            }),
        ee.Feature(
            ee.Geometry.Point([74.07672229499038, 32.59330618921214]),
            {
              "landcover": 3,
              "system:index": "28"
            }),
        ee.Feature(
            ee.Geometry.Point([74.07747331351455, 32.59175143179278]),
            {
              "landcover": 3,
              "system:index": "29"
            }),
        ee.Feature(
            ee.Geometry.Point([74.07481256217177, 32.59136273822333]),
            {
              "landcover": 3,
              "system:index": "30"
            }),
        ee.Feature(
            ee.Geometry.Point([74.08269433109781, 32.58122454464476]),
            {
              "landcover": 3,
              "system:index": "31"
            }),
        ee.Feature(
            ee.Geometry.Point([74.08440558044931, 32.5812471457103]),
            {
              "landcover": 3,
              "system:index": "32"
            }),
        ee.Feature(
            ee.Geometry.Point([74.08460406391642, 32.58169464563521]),
            {
              "landcover": 3,
              "system:index": "33"
            }),
        ee.Feature(
            ee.Geometry.Point([74.08547309963724, 32.58116126163087]),
            {
              "landcover": 3,
              "system:index": "34"
            }),
        ee.Feature(
            ee.Geometry.Point([74.08140150635263, 32.58167204468247]),
            {
              "landcover": 3,
              "system:index": "35"
            }),
        ee.Feature(
            ee.Geometry.Point([74.08237246601603, 32.581061816804514]),
            {
              "landcover": 3,
              "system:index": "36"
            }),
        ee.Feature(
            ee.Geometry.Point([74.08237783043405, 32.580962371867855]),
            {
              "landcover": 3,
              "system:index": "37"
            }),
        ee.Feature(
            ee.Geometry.Point([74.08237246601603, 32.5804063822352]),
            {
              "landcover": 3,
              "system:index": "38"
            }),
        ee.Feature(
            ee.Geometry.Point([74.08281234829447, 32.580334058127136]),
            {
              "landcover": 3,
              "system:index": "39"
            }),
        ee.Feature(
            ee.Geometry.Point([74.09218695004938, 32.582121455444614]),
            {
              "landcover": 3,
              "system:index": "40"
            }),
        ee.Feature(
            ee.Geometry.Point([74.09120526154993, 32.58200845116187]),
            {
              "landcover": 3,
              "system:index": "41"
            }),
        ee.Feature(
            ee.Geometry.Point([74.07824399492272, 32.59066456262457]),
            {
              "landcover": 3,
              "system:index": "42"
            }),
        ee.Feature(
            ee.Geometry.Point([74.07719256898888, 32.590384338450406]),
            {
              "landcover": 3,
              "system:index": "43"
            })]);
/***** End of imports. If edited, may not auto-convert in the playground. *****/
//Attock
// Define an area of interest 
//var lon = 71.52; 
//var lat = 30.15;
//var point = ee.Geometry.Point(lon, lat); // Lahore
//var aoi = table; // Create an area (1km buffer around point)
//Map.setCenter(lon, lat, 13); // Center the map on this location
//Map.addLayer(s2)

Map.addLayer(table2)
var s2_filtered = s2.filterBounds(table2)
            .filterDate('2020-03-01','2020-03-15')
            .filterMetadata('CLOUDY_PIXEL_PERCENTAGE', 'less_than', 1)
            .sort('CLOUDY_PIXEL_PERCENTAGE')
            
//Map.addLayer(s2_filtered,s2_vp,'s2 collection')
var vizParams = {bands:['B8','B4','B3'], min:300, max:[2000, 2000, 3000]};

var s2_median=s2_filtered.median()
print(s2_filtered)    // puri image collection me 73 elements hain 
var s2_clip=s2_median.clip(table2)
//Map.addLayer(s2_filtered,vizParams,'s2 collection march')
Map.addLayer(s2_median,vizParams,'s2 march median')



var newfc = builtup.merge(barren).merge(water).merge(vegetation);
print(newfc)
// Use these bands in the prediction.
var bands = ['B2', 'B3', 'B4', 'B5', 'B6', 'B7','B8', 'B9'];
// Make training data by 'overlaying' the points on the image.
var training = s2_median.select(bands).sampleRegions({
  collection: newfc, 
  properties: ['landcover'], 
  scale: 30
});

// Get a CART classifier and train it.
var classifier = ee.Classifier.smileCart().train({
  features: training, 
  classProperty: 'landcover', 
  inputProperties: bands
});

// Classify the image.
var classified = s2_clip.select(bands).classify(classifier);
Map.addLayer(classified, {min: 0, max: 3, palette: ['red', 'green', 'blue','purple']}, 'classification');

//red builtup-green barren-dark blue water-yellow wheat-light blue other crop 
Export.image.toDrive({
  image: classified,
  description: 'Gujratland',
  scale: 40,
  region: table2,
  maxPixels: 1e9
});

// Export the FeatureCollection to a KML file.
//Export.table.toDrive({
//  collection: newfc,
 // description:'Attock',
 // fileFormat: 'KML'
//});



